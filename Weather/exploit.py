import sys


DEFAULT_INPUT_FILENAME = 'temperature_data'


def extract_temperatures(data):
    return [
        reversed(data[i + 24: i + 32])
        for i in range(0, len(data), 32)]


def to_bits(temperature):
    return ''.join(
        bin(byte_value)[2:].zfill(8)
        for byte_value in temperature)


def is_nan(double_bits):
    return double_bits[1:12] == '1' * 11


def extract_payload_bits(fake_temperature):
    return fake_temperature[12:]


def main():
    filename = ' '.join(sys.argv[1:]) or DEFAULT_INPUT_FILENAME
    with open(filename, 'rb') as inp:
        data = inp.read()

    if len(data) % 32 != 0:
        print('The input is not valid')
        return

    payload_bits = ''.join(
        map(extract_payload_bits,
            filter(is_nan,
                   map(to_bits,
                       extract_temperatures(data)))))
    payload_bits = payload_bits[: len(payload_bits) - len(payload_bits) % 8]
    payload_byte_values = [
        int(payload_bits[i: i + 8], 2)
        for i in range(0, len(payload_bits), 8)]
    payload = bytes(payload_byte_values)
    print(payload)


if __name__ == '__main__':
    main()
